/*! angular-selector - v1.0.0 - https://github.com/indrimuska/angular-selector - (c) 2015 Indri Muska - MIT */
!function(a){var b={up:38,down:40,left:37,right:39,escape:27,enter:13,backspace:8,"delete":46,shift:16,leftCmd:91,rightCmd:93,ctrl:17,alt:18,tab:9},c=function(){function c(a){return a instanceof HTMLElement?a.ownerDocument&&a.ownerDocument.defaultView.opener?a.ownerDocument.defaultView.getComputedStyle(a):window.getComputedStyle(a):{}}function d(a,b,c,d,e){this.restrict="EA",this.replace=!0,this.transclude=!0,this.scope={name:"@?",value:"=model",disabled:"=?disable",multiple:"=?multi",placeholder:"@?",valueAttr:"@",labelAttr:"@?",groupAttr:"@?",options:"=?",rtl:"=?",api:"=?",remote:"=?",remoteParam:"@?",removeButton:"=?",viewItemTemplate:"=?",dropdownItemTemplate:"=?",dropdownGroupTemplate:"=?"},this.templateUrl="selector/selector.html",$filter=a,$timeout=b,$window=c,$http=d,$q=e}return d.prototype.$inject=["$filter","$timeout","$window","$http","$q"],d.prototype.link=function(d,e,f,g,h){h(d,function(d,g){var h=a.element(e[0].querySelector(".selector-input input")),i=a.element(e[0].querySelector(".selector-input")),j=a.element(e[0].querySelector(".selector-dropdown")),k=$q.defer(),l={api:{},selectedValues:[],highlighted:0,valueAttr:null,labelAttr:"label",groupAttr:"group",options:[],remoteParam:"q",removeButton:!0,viewItemTemplate:"selector/item-default.html",dropdownItemTemplate:"selector/item-default.html",dropdownGroupTemplate:"selector/group-default.html"};a.isDefined(g.value)||(g.value=g.multiple?[]:""),a.forEach(l,function(b,c){a.isDefined(g[c])||(g[c]=b)}),a.forEach(["name","valueAttr","labelAttr"],function(a){f[a]||(f[a]=g[a])}),g.optionValue=function(a){return null==g.valueAttr?a:a[g.valueAttr]},g.optionEquals=function(b,c){return a.equals(g.optionValue(b),a.isDefined(c)?c:g.value)},g.setValue=function(a){g.multiple?g.value=null==g.valueAttr?a||[]:(a||[]).map(function(a){return a[g.valueAttr]}):g.value=null==g.valueAttr?a||{}:(a||{})[g.valueAttr]},g.hasValue=function(){return g.multiple?(g.value||[]).length>0:null==g.valueAttr?!a.equals({},g.value):g.value},g.fetch=function(){var b={method:"GET",cache:!0,params:{}};if(!a.isDefined(g.disabled)||g.disabled!==!0){if(!a.isDefined(g.remote)||!a.isObject(g.remote))throw"Remote attribute is not an object";a.extend(b,g.remote),a.extend(b.params,g.remote.params),b.params[g.remoteParam]=g.search||"",g.loading=!0,g.options=[],$http(b).then(function(a){g.options=a.data,g.filterSelected(),g.loading=!1,k.resolve()},function(){throw g.loading=!1,k.reject(),"Error while fetching data"})}},a.isDefined(g.remote)&&a.isObject(g.remote)||(g.remote=!1,k.resolve()),g.remote&&(g.$watch("search",g.fetch),a.isDefined(g.disabled)&&g.$watch("disabled",function(a,b){a!==b&&a===!1&&g.fetch()})),g.optionToObject=function(b,c){var d={},e=a.element(b);a.forEach(b.dataset,function(a,b){b.match(/^\$/)||(d[b]=a)}),b.value&&(d[g.valueAttr||"value"]=b.value),e.text()&&(d[g.labelAttr]=e.text().trim()),a.isDefined(c)&&(d[g.groupAttr]=c),g.options.push(d),!e.attr("selected")||!g.multiple&&g.hasValue()||(g.multiple?(g.value||(g.value=[]),g.value.push(g.optionValue(d))):g.value||(g.value=g.optionValue(d)))},g.fillWithHtml=function(){g.options=[],a.forEach(d,function(b){var c=(b.tagName||"").toLowerCase();"option"==c&&g.optionToObject(b),"optgroup"==c&&a.forEach(b.querySelectorAll("option"),function(a){g.optionToObject(a,(b.attributes.label||{}).value)})}),g.updateSelected()},g.initialize=function(){g.remote||a.isArray(g.options)&&g.options.length||g.fillWithHtml(),g.hasValue()&&(g.multiple?a.isArray(g.value)||(g.value=[g.value]):a.isArray(g.value)&&(g.value=g.value[0]),g.updateSelected(),g.filterSelected(),g.updateValue())},g.$watch("multiple",function(){$timeout(g.setInputWidth),k.promise.then(g.initialize,g.initialize)}),g.dropdownPosition=function(){var a=h.parent()[0],b=c(a),d=parseFloat(b.marginTop||0),e=parseFloat(b.marginLeft||0);parseFloat(b.marginRight||0);j.css({top:a.offsetTop+a.offsetHeight+d+"px",left:a.offsetLeft+e+"px",width:a.offsetWidth+"px"})},g.open=function(){g.isOpen=!0,g.dropdownPosition()},g.close=function(){g.isOpen=!1,g.resetInput()},g.decrementHighlighted=function(){g.highlight(g.highlighted-1),g.scrollToHighlighted()},g.incrementHighlighted=function(){g.highlight(g.highlighted+1),g.scrollToHighlighted()},g.highlight=function(a){g.filteredOptions.length&&(g.highlighted=(g.filteredOptions.length+a)%g.filteredOptions.length)},g.scrollToHighlighted=function(){var a=j[0],b=a.querySelectorAll("li.selector-option")[g.highlighted],d=c(b),e=parseFloat(d.marginTop||0),f=parseFloat(d.marginBottom||0);g.filteredOptions.length&&(b.offsetTop+b.offsetHeight+f>a.scrollTop+a.offsetHeight&&$timeout(function(){a.scrollTop=b.offsetTop+b.offsetHeight+f-a.offsetHeight}),b.offsetTop-e<a.scrollTop&&$timeout(function(){a.scrollTop=b.offsetTop-e}))},g.set=function(b){a.isDefined(b)||(b=g.filteredOptions[g.highlighted]),g.multiple?g.selectedValues.indexOf(b)<0&&g.selectedValues.push(b):g.selectedValues=[b],g.multiple||g.close(),g.resetInput()},g.unset=function(b){g.multiple?g.selectedValues.splice(a.isDefined(b)?b:g.selectedValues.length-1,1):g.selectedValues=[],g.resetInput()},g.keydown=function(a){switch(a.keyCode){case b.up:if(!g.isOpen)break;g.decrementHighlighted(),a.preventDefault();break;case b.down:g.isOpen?g.incrementHighlighted():g.open(),a.preventDefault();break;case b.escape:g.highlight(0),g.close();break;case b.enter:g.isOpen&&(g.filteredOptions.length&&g.set(),a.preventDefault());break;case b.backspace:h.val()||(g.unset(),g.open());break;case b.left:case b.right:case b.shift:case b.ctrl:case b.alt:case b.tab:case b.leftCmd:case b.rightCmd:break;default:!g.multiple&&g.hasValue()?a.preventDefault():(g.open(),g.highlight(0))}},g.inOptions=function(b,c){return g.remote?b.filter(function(b){return a.equals(c,b)}).length>0:b.indexOf(c)>=0},g.filterSelected=function(){g.filteredOptions=$filter("filter")(g.options||[],g.search),g.multiple&&(g.filteredOptions=g.filteredOptions.filter(function(b){var c=a.isArray(g.selectedValues)?g.selectedValues:[g.selectedValues];return!g.inOptions(c,b)})),g.highlighted>=g.filteredOptions.length&&g.highlight(g.filteredOptions.length-1)},g.measureWidth=function(){var b,d=c(h[0]),e=a.element('<span class="selector-shadow"></span>');return e.text(h.val()||(g.hasValue()?"":g.placeholder)||""),h.parent().append(e),a.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(a){e.css(a,d[a])}),b=e[0].offsetWidth,e.remove(),b},g.setInputWidth=function(){var a=g.measureWidth()+1;h.css("width",a+"px")},g.resetInput=function(){h.val(""),g.search="",g.setInputWidth()},g.$watch("[search, options, value]",function(){g.setInputWidth(),g.filterSelected(),g.isOpen&&$timeout(g.dropdownPosition)},!0),g.updateValue=function(b){a.isDefined(b)||(b=g.selectedValues),g.setValue(g.multiple?b:b[0])},g.$watch("selectedValues",function(b,c){a.equals(b,c)||g.updateValue()},!0),g.$watch("options",function(b,c){a.equals(b,c)||g.remote||g.updateSelected()}),g.updateSelected=function(){g.multiple?g.selectedValues=(g.value||[]).map(function(a){return $filter("filter")(g.options,function(b){return g.optionEquals(b,a)})[0]}).filter(function(b){return a.isDefined(b)}):g.selectedValues=(g.options||[]).filter(function(a){return g.optionEquals(a)}).slice(0,1)},g.$watch("value",function(b,c){a.equals(b,c)||g.remote||g.updateSelected()},!0),a.element($window).on("click",function(a){for(var b=a.target;null!==b&&void 0!==b;){if(b===e[0])return!1;b=b.parentElement}return g.$apply(g.close),a.preventDefault(),!0}),h.on("focus",function(){$timeout(function(){g.$apply(g.open)})}).on("blur",function(){}).on("keydown",function(a){g.$apply(function(){g.keydown(a)})}).on("input",function(){g.setInputWidth()}),i.on("click",function(){$timeout(function(){g.$apply(g.open)})}),j.on("mousedown",function(a){a.preventDefault()}),a.element($window).on("resize",function(){g.dropdownPosition()}),a.forEach(["open","close","fetch"],function(a){g.api[a]=g[a]}),g.api.focus=function(){h[0].focus()},g.api.set=function(b){var c=(g.filteredOptions||[]).filter(function(a){return g.optionEquals(a,b)});a.forEach(c,function(a){g.set(a)})},g.api.unset=function(b){var c=b?(g.selectedValues||[]).filter(function(a){return g.optionEquals(a,b)}):g.selectedValues;indexes=g.selectedValues.map(function(a,b){return g.inOptions(c,a)?b:-1}).filter(function(a){return a>=0}),a.forEach(indexes,function(a,b){g.unset(a-b)})}})},d}();a.module("selector",[]).run(["$templateCache",function(a){a.put("selector/selector.html",'<div class="selector" ng-attr-dir="{{rtl ? \'rtl\' : \'ltr\'}}" ng-class="{open: isOpen, empty: !filteredOptions.length, multiple: multiple, \'has-value\': hasValue(), rtl: rtl, loading: loading, \'remove-button\': removeButton, disabled: disabled}"><select name="{{name}}" ng-hide="true" ng-model="selectedValues" multiple ng-options="option as option[labelAttr] for option in selectedValues" ng-hide="true"></select><label class="selector-input"><ul class="selector-values"><li ng-repeat="(index, option) in selectedValues track by index"><div ng-include="viewItemTemplate"></div><div ng-if="multiple" class="selector-helper" ng-click="!disabled && unset(index)"><span class="selector-icon"></span></div></li></ul><input class="selector" ng-model="search" placeholder="{{!hasValue() ? placeholder : \'\'}}" ng-disabled="disabled"><div ng-if="!multiple || loading" class="selector-helper selector-global-helper" ng-click="!disabled && removeButton && unset()"><span class="selector-icon"></span></div></label><ul class="selector-dropdown" ng-show="filteredOptions.length > 0"><li ng-repeat-start="(index, option) in filteredOptions track by index" class="selector-optgroup" ng-include="dropdownGroupTemplate" ng-show="option[groupAttr] && index == 0 || filteredOptions[index-1][groupAttr] != option[groupAttr]"></li><li ng-repeat-end ng-class="{active: highlighted == index, grouped: option[groupAttr]}" class="selector-option" ng-include="dropdownItemTemplate" ng-mouseover="highlight(index)" ng-click="set()"></li></ul></div>'),a.put("selector/item-default.html",'<span ng-bind="option[labelAttr]"></span>'),a.put("selector/group-default.html",'<span ng-bind="option[groupAttr]"></span>')}]).directive("selector",["$filter","$timeout","$window","$http","$q",function(a,b,d,e,f){return new c(a,b,d,e,f)}])}(window.angular);